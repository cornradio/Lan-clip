<!DOCTYPE html>
<html data-theme="dark">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- 添加苹果快捷方式图标 -->
    <link rel="icon" href="{{ url_for('static', filename='lizard.png') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='liz2.png') }}" />
    <title>Lan-clip</title>
    <!-- APP模式下，顶部空白处的颜色,可选为 default black black-translucent , default 使用 body 的背景色 -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!--  App 名称，在用户选择添加到主页的时候这个名字会自动蹦出来 -->
    <meta name="apple-mobile-web-app-title" content="LanClip">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <header id="banner">
        <div class="banner-wrap">
            <div class="banner-left">
                <div class="logo">
                    <img src="{{ url_for('static', filename='lizard.png') }}" alt="Logo">
                </div>
                <span class="title">LAN Clip</span>
            </div>
            <div class="banner-right">
                <button onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="icon-button"
                    style="padding: 0; margin-right: 15px;">
                    <i class="fas fa-arrow-up"></i>
                </button>
                <!-- todo，这个模式还在优化中 -->
                <!-- <button onclick="toggleGridMode()" id="grid-mode-btn" class="icon-button" title="切换视图"
                    style="padding: 0; margin-right: 15px;">
                    <i class="fas fa-border-all"></i>
                </button> -->
                <button onclick="enterHighlightMode()" class="icon-button" title="进入选中模式"
                    style="padding: 0; margin-right: 15px;">
                    <i class="fas fa-mouse-pointer"></i>
                </button>
                <button onclick="showGallery()" class="icon-button" title="图册预览"
                    style="padding: 0; margin-right: 15px;">
                    <i class="fas fa-images"></i>
                </button>
                <button onclick="showSettings()" class="icon-button" title="设置" style="padding: 0;">
                    <i class="fas fa-cog"></i>
                </button>
                <!-- <a href="https://github.com/cornradio/LANwebclipboard-win-flask/" target="_blank" class="github-button">
                    <i class="fab fa-github"></i>
                </a> -->
            </div>
        </div>
    </header>

    <div class="body">

        <div id="background"></div>
        <!-- 拖放区域 -->
        <div id="drop-zone"
            style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999;">
            <div
                style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 24px;">
                拖放文件到这里上传
            </div>
        </div>
        <!-- 输入区域 -->
        <div class="input-form">
            <div class="input-container">
                <textarea id="input-text" name="text" placeholder="键入文本或粘贴图片..."></textarea>
                <div class="button-group">
                    <button onclick="addCard()" id="add-btn" class="icon-button" title="添加">
                        <i class="fas fa-paper-plane"></i>
                        <span style="margin-left: 5px;">发送</span>
                    </button>
                    <button onclick="window.location.href='/'" class="icon-button" title="刷新">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button onclick="document.getElementById('file-input').click()" class="icon-button" title="上传图片">
                        <i class="fas fa-image"></i>
                        <input type="file" id="file-input" style="display: none;" accept="image/*" multiple
                            onchange="uploadImage(this.files); this.value='';">
                    </button>
                    <button onclick="document.getElementById('file-input2').click()" class="icon-button" title="上传文件">
                        <i class="fas fa-file-upload"></i>
                        <input type="file" id="file-input2" style="display: none;" accept="*" multiple
                            onchange="uploadFiles(this.files); this.value='';">
                    </button>
                    <button onclick="toggleFullscreenInput()" id="fullscreen-btn" class="icon-button" title="全屏编辑"
                        style="margin-left: auto;">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- 卡片展示区域 -->
        <div class="card" id="card-container">
            {% for card in (cards|reverse|list)[:20] %}
            <div class="card-wrapper" data-id="{{ card.id }}">
                <div class="card-header">
                    <button onclick="copyToClipboard(this)" class="icon-button raw-button download-button"
                        title="复制到剪贴板" style="padding: 4px 8px; font-size: 12px;">
                        <i class="fas fa-copy"></i>
                    </button>
                    <button onclick="editCard(this)" class="icon-button raw-button" title="编辑"
                        style="padding: 4px 8px; font-size: 12px;">
                        <i class="fas fa-edit"></i>
                    </button>
                    <!-- downloadbtn -->
                    <button onclick="downloadCard(this)" class="icon-button raw-button download-button"
                        style="padding: 4px 8px; font-size: 12px;" title="下载">
                        <i class="fas fa-download"></i>
                    </button>
                    <button onclick="deleteCard(this)" class="icon-button raw-button delete-button"
                        style="padding: 4px 8px; font-size: 12px;" title="删除">
                        <i class="fas fa-trash"></i>
                    </button>

                </div>
                <pre class="card-content">{{ card.content | safe }}</pre>
                <div class="card-time" data-timestamp="{{ card.timestamp }}">{{ card.time }}</div>
            </div>
            {% endfor %}
        </div>

        <div id="main-loader"
            style="text-align: center; padding: 20px; display: none; color: var(--text-color); opacity: 0.6;">
            <i class="fas fa-spinner fa-spin"></i> 正在加载更多...
        </div>

        <!-- 上传进度模态窗 -->
        <div id="upload-modal" class="modal" style="display: none;">
            <div class="modal-content upload-modal-content">
                <div class="modal-header">
                    <h3>正在上传</h3>
                </div>
                <div class="modal-body">
                    <div id="upload-status-text" style="margin-bottom: 12px; color: var(--text-color);">
                        正在准备上传...
                    </div>
                    <div class="upload-progress-bar">
                        <div class="upload-progress-inner" id="upload-progress-inner"></div>
                    </div>
                </div>
            </div>
        </div>




        <!-- 修改图片预览模态窗 -->
        <div id="image-modal" class="modal" style="display: none;">
            <div class="modal-content image-modal-content">
                <div class="modal-header">
                    <div class="image-counter">
                        <span id="current-image-number">1</span>/<span id="total-images">1</span>
                    </div>
                    <div class="modal-actions">
                        <button class="nav-button prev-button" onclick="showPrevImage()" title="上一张">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="nav-button next-button" onclick="showNextImage()" title="下一张">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                        <button class="action-button" onclick="downloadCurrentImage()" title="下载当前图片">
                            <i class="fas fa-download"></i>
                        </button>
                        <button class="action-button" onclick="openImageInNewTab()" title="在新标签页中打开">
                            <i class="fas fa-external-link-alt"></i>
                        </button>
                        <button class="close-button" onclick="closeImageModal()" title="关闭">
                            <i class="fas fa-times"></i>
                        </button>

                    </div>
                </div>
                <div class="modal-body image-modal-body">
                    <img id="modal-image" src="" alt="预览图片">
                </div>
            </div>
        </div>

        <!-- 图册预览模态窗 -->
        <div id="gallery-modal" class="modal" style="display: none;">
            <div class="modal-content gallery-modal-content">
                <div class="modal-header">
                    <h3>图册预览</h3>
                    <button class="close-button" onclick="closeGallery()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body gallery-grid" id="gallery-grid">
                    <!-- 图片将通过JS动态加载 -->
                </div>
            </div>
        </div>

        <!-- 添加设置模态窗 -->
        <div id="settings-modal" class="modal" style="display: none;">
            <div class="modal-content settings-modal-content">
                <div class="modal-header">
                    <h3>设置</h3>
                    <button class="close-button" onclick="closeSettings()">
                        <i class="fas fa-times"></i>
                    </button>

                </div>
                <div class="modal-body">
                    <div class="settings-section">
                        <h4>显示设置</h4>
                        <div class="setting-item">
                            <label class="switch">
                                <input type="checkbox" id="simple-mode-toggle" onchange="toggleSimpleMode()">
                                <span class="slider"></span>
                            </label>
                            <span class="setting-label">简洁模式（隐藏背景图片）</span>
                        </div>

                        <div class="setting-item">
                            <label class="switch">
                                <input type="checkbox" id="clear-history-toggle" onchange="clearHistory()">
                                <span class="slider"></span>
                            </label>
                            <span class="setting-label">清空历史记录</span>
                        </div>

                        <div class="setting-item">
                            <label class="switch">
                                <input type="checkbox" id="auto-compress-toggle" onchange="toggleAutoCompress()">
                                <span class="slider"></span>
                            </label>
                            <span class="setting-label">自动压缩图片</span>
                        </div>

                        <div id="compression-quality-container" class="setting-item"
                            style="display: none; flex-direction: column; align-items: flex-start; gap: 8px;">
                            <div style="display: flex; justify-content: space-between; width: 100%;">
                                <span class="setting-label">压缩质量: <span id="quality-value">80</span>%</span>
                            </div>
                            <input type="range" id="compression-quality-slider" min="1" max="100" value="80"
                                style="width: 100%;" oninput="updateCompressionQuality(this.value)">
                        </div>
                    </div>

                    <div class="settings-section">
                        <h4>使用提示</h4>
                        <div class="tips-list">
                            <div class="tip-item">
                                <i class="fas fa-keyboard"></i>
                                <span>Ctrl+Enter 快速发送消息</span>
                            </div>
                            <div class="tip-item">
                                <i class="fas fa-image"></i>
                                <span>点击图片可以查看大图</span>
                            </div>
                            <div class="tip-item">
                                <i class="fas fa-arrows-alt"></i>
                                <span>使用方向键切换图片</span>
                            </div>
                            <div class="tip-item">
                                <i class="fas fa-file-upload"></i>
                                <span>支持拖拽上传文件</span>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h4>选中模式</h4>
                        <div class="tips-list">
                            <div class="tip-item">
                                <i class="fas fa-mouse-pointer"></i>
                                <span>双击卡片或点击顶部图标进入选中模式</span>
                            </div>
                            <div class="tip-item">
                                <i class="fas fa-arrows-alt"></i>
                                <span>方向键 ↑ ↓ ← → 切换选中卡片</span>
                            </div>
                            <div class="tip-item">
                                <i class="fas fa-trash"></i>
                                <span>Delete / Backspace 删除选中卡片</span>
                            </div>
                            <div class="tip-item">
                                <i class="fas fa-copy"></i>
                                <span>C 复制内容 / D 下载附件 / E 编辑内容</span>
                            </div>
                            <div class="tip-item">
                                <i class="fas fa-times"></i>
                                <span>Esc 退出选中模式</span>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h4>关于</h4>
                        <div class="about-links">
                            <a href="https://github.com/cornradio/LAN-clip" target="_blank" class="about-link">
                                <i class="fab fa-github"></i>
                                <span>GitHub 仓库</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script src="{{ url_for('static', filename='main.js') }}"></script>

    </div>
</body>

</html>